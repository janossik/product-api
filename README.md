# Product API

API for cataloging products, tags and categories. Built with Node.js, Express and any database as knex and objection.js are used allowing for quick database changes. The project serves as a starter pack rather than a full solution.

## Products

### GET `/products`
Returns a list of products.

#### Query Parameters
- `offset` - The offset to start returning products from. Defaults to 0
- `limit` - The number of products to return per page. Defaults to 10.
- `name` - A search term to filter products by name.

### GET `/products/:id`
Returns a single product by id.

### POST `/products`
Creates a new product.

#### Request Body
- `name` - The name of the product.
- `author` - The person who added the product.
- `code` - The code of the product.
- `description` - The description of the product.

### PUT `/products/:id`
Updates a product by id.

#### Request Body
- `name` - The name of the product.
- `author` - The person who added the product.
- `code` - The code of the product.
- `description` - The description of the product.

### DELETE `/products/:id`
Deletes a product by id.

---

## Tags

### GET `/tags`
Returns a list of tags.

#### Query Parameters
- `offset` - The offset to start returning tags from. Defaults to 0
- `limit` - The number of tags to return per page. Defaults to 10.
- `name` - A search term to filter tags by name.

### GET `/tags/:id`
Returns a single tag by id.

### POST `/tags`
Creates a new tag.

#### Request Body
- `name` - The name of the tag.

### PUT `/tags/:id`
Updates a tag by id.

#### Request Body
- `name` - The name of the tag.

### DELETE `/tags/:id`
Deletes a tag by id.

---

## Categories

### GET `/categories`
Returns a list of categories.

- `offset` - The offset to start returning categories from. Defaults to 0
- `limit` - The number of categories to return per page. Defaults to 10.
- `name` - A search term to filter categories by name.

### GET `/categories/:id`
Returns a single category by id.

### POST `/categories`
Creates a new category.

#### Request Body
- `name` - The name of the category.

### PUT `/categories/:id`
Updates a category by id.

#### Request Body
- `name` - The name of the category.

### DELETE `/categories/:id`
Deletes a category by id.

---

## More about the project

Logic related to endpoints, you keep in api directory. To create a new **endpoint** such as `users` you should create a new users directory in the api directory. Where you should put the logic related to `users`, i.e. `user.controller.ts`, `user.service.ts`, `user.router.ts` (**one router type file is required**), `user.model.ts`, `user.schema.ts` and `user.d.ts`.

- `user.controller.ts`: is responsible for handling the logic related to query handling, using `service` for this.
- `user.service.ts`: is responsible for handling the business logic, i.e. database queries, etc.
- `user.router.ts`: is responsible for exposing the corresponding endpoints using controller.
- `user.model.ts`: is responsible for creating the model and relationships between models for the ORM.
- `user.schema.ts`: is responsible for creating an object according to [json-schema](https://json-schema.org) with which requests will be validated.
- `user.d.ts`: is responsible for storing types related to user logic

Other directories located in `src`, have a purpose for the entire application or are reusable.

```
├── dist // generated by `npm run build`
├── src
│   ├── api
│   │   ├── categories
│   │   │   ├── category.controller.ts
│   │   │   ├── category.model.ts
│   │   │   ├── category.router.ts
│   │   │   ├── category.schema.ts
│   │   │   └── category.service.ts
│   │   ├── products
│   │   │   ├── product.controller.ts
│   │   │   ├── product.d.ts
│   │   │   ├── product.model.ts
│   │   │   ├── product.router.ts
│   │   │   ├── product.schema.ts
│   │   │   └── product.service.ts
│   │   ├── tags
│   │   │   ├── tag.controller.ts
│   │   │   ├── tag.model.ts
│   │   │   ├── tag.router.ts
│   │   │   ├── tag.schema.ts
│   │   │   └── tag.service.ts
│   │   ├── [name]s (plural for the holding directory) (singular for files)
│   │   │   ├── [name].controller.ts
│   │   │   ├── [name].model.ts
│   │   │   ├── [name].router.ts
│   │   │   ├── [name].schema.ts
│   │   │   └── [name].service.ts
│   │   └── index.ts // logic for combining all routers
│   ├── index.ts
├── config
│   ├── index.ts // logic for combining all configs and importing in start script
│   └── [name].ts
├── error
│   ├── error-handler.ts // global error handler middleware
│   ├── error-with-status.ts // custom error class
│   └── [name].ts
├── middleware
│   ├── validation.middleware.ts // validation request middleware for router
│   └── [name].middleware.ts
├── schemas // reusable scheme
│   ├── query.schema.ts // query schema for validation
│   └── [name].schema.ts
├── types // reusable types or global types
│   ├── environment.d.ts // global types for environment variables
│   ├── query.d.ts // global types for query parameters 
│   └── [name].d.ts 
├── utils // assistive functions or other data
│   ├── server.utils.ts // server utils
│   └── [name].utils.ts
├── .env
├── env.example
├── knexfile.ts // knex config
├── package.json
└── [...other files]
```

### Environment variables

Environment variables are stored in `.env` file. You can use `env.example` as a template for your `.env` file.

```
NODE_ENV=development
PORT=
SSL_PORT=
DATABASE_NAME=
USERNAME=
PASSWORD=
CERTIFICATE_PATH=
CERTIFICATE_NAME=
```

### Database

The project uses [knex](https://knexjs.org) as a query builder. You can find the configuration in `knexfile.ts`. For production, you can use any database supported by knex. 
ORM models are located in `src/api/[name]s/[name].model.ts` and are used in `src/api/[name]s/[name].service.ts`. [Objection.js](https://vincit.github.io/objection.js) is used as ORM.
### Migrations

To create a new migration, you can use the following command:

```bash
knex migrate:make migration_name -x ts
```

To run migrations, you can use the following command:

```bash
npm run migrate
```

#### Rollback

To rollback migrations, you can use the following command:

```bash
npm run rollback
```

### Seeds

To create a new seed, you can use the following command:

```bash
knex seed:make seed_name -x ts
```

To run seeds, you can use the following command:

```bash
npm run seed
```

## Building and running the project

### Building

To build the project, you can use the following command:

```bash
npm run build
```

### Running

For development, you can use the following command:

```bash
npm run dev
```

For built project, you can use the following command:

```bash

cd dist;
npm run start;
```



